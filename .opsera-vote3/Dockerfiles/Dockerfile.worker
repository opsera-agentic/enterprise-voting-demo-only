# Worker Service Dockerfile - Cloud Database Ready
# Generated by Opsera Code-to-Cloud Enterprise v0.905

FROM mcr.microsoft.com/dotnet/sdk:7.0 AS build
WORKDIR /source

# Copy csproj and restore dependencies
COPY worker/*.csproj .
RUN dotnet restore

# Copy everything and build
COPY worker/ .
RUN dotnet publish -c Release -o /app

# Runtime stage
FROM mcr.microsoft.com/dotnet/runtime:7.0
WORKDIR /app

COPY --from=build /app .

# Environment variables for cloud database connections
# These are injected via K8s ConfigMap/Secrets
ENV DATABASE_HOST=""
ENV DATABASE_PORT="5432"
ENV DATABASE_NAME="votes"
ENV DATABASE_USER="app_user"
ENV DATABASE_USE_IAM_AUTH="true"
ENV REDIS_HOST=""
ENV REDIS_PORT="6379"
ENV AWS_REGION="us-west-2"

CMD ["dotnet", "Worker.dll"]
